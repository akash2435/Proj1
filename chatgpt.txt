a@page "/"
@inject GoogleMapsService MapsService

<h3>Property Search</h3>
<input @bind="SearchQuery" placeholder="Enter property address" />
<button @onclick="GetMapImage">Search</button>

@if (!string.IsNullOrEmpty(MapImageUrl))
{
    <img src="@MapImageUrl" alt="Property Image" width="600" />
    <button @onclick="DownloadPdf">Download Report</button>
}

@code {
    private string SearchQuery { get; set; }
    private string MapImageUrl { get; set; }

    private void GetMapImage()
    {
        MapImageUrl = MapsService.GetStaticMapUrl(SearchQuery);
    }

    private async Task DownloadPdf()
    {
        var url = $"/api/report?address={Uri.EscapeDataString(SearchQuery)}";
        await JS.InvokeVoidAsync("open", url, "_blank");
    }
}
================
using Microsoft.AspNetCore.Mvc;
using iTextSharp.text;
using iTextSharp.text.pdf;
using System.IO;
using System.Net.Http;
using System.Threading.Tasks;

[Route("api/report")]
[ApiController]
public class ReportController : ControllerBase
{
    private readonly GoogleMapsService _mapsService;
    private readonly HttpClient _httpClient;

    public ReportController(GoogleMapsService mapsService, HttpClient httpClient)
    {
        _mapsService = mapsService;
        _httpClient = httpClient;
    }

    [HttpGet]
    public async Task<IActionResult> GenerateReport([FromQuery] string address)
    {
        string imageUrl = _mapsService.GetStaticMapUrl(address);
        byte[] imageBytes = await _httpClient.GetByteArrayAsync(imageUrl);

        using MemoryStream ms = new();
        Document document = new(PageSize.A4);
        PdfWriter.GetInstance(document, ms);
        document.Open();

        document.Add(new Paragraph($"Property Report: {address}"));
        document.Add(new Paragraph("\n"));

        Image image = Image.GetInstance(imageBytes);
        image.ScaleToFit(500, 300);
        document.Add(image);
        document.Close();

        return File(ms.ToArray(), "application/pdf", "PropertyReport.pdf");
    }
}


@page "/property-map"

@inject HttpClient Http

<h3>Property Map</h3>

<input @bind="Address" placeholder="Enter Address" class="form-control" />
<button @onclick="GetMapImage" class="btn btn-primary">Get Map</button>

@if (!string.IsNullOrEmpty(MapImageUrl))
{
    <img src="@MapImageUrl" alt="Property Map" style="width: 600px; height: 400px;" />
}

@code {
    private string Address { get; set; } = "";
    private string MapImageUrl { get; set; } = "";

    private async Task GetMapImage()
    {
        if (string.IsNullOrWhiteSpace(Address))
            return;

        // 1️⃣ Call API to get Latitude & Longitude
        var geocodeResponse = await Http.GetFromJsonAsync<GeocodeResponse>($"https://localhost:5001/api/property/geocode?address={Address}");

        if (geocodeResponse != null)
        {
            // 2️⃣ Call API to get Google Maps Image URL
            var mapResponse = await Http.GetFromJsonAsync<MapImageResponse>($"https://localhost:5001/api/property/mapimage?lat={geocodeResponse.Latitude}&lng={geocodeResponse.Longitude}");

            if (mapResponse != null)
            {
                MapImageUrl = mapResponse.ImageUrl;
            }
        }
    }

    // DTO Models
    private class GeocodeResponse
    {
        public double Latitude { get; set; }
        public double Longitude { get; set; }
    }

    private class MapImageResponse
    {
        public string ImageUrl { get; set; }
    }
}
